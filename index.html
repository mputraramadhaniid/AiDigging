<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI DIGGING - Ready to help you</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/renvonovel.appspot.com/o/20250316_191334.jpg?alt=media&token=afb5c73d-872f-4e27-ad76-13f4c2b4481a" type="image/png" />
    <style>
      /* Reset & base */
      body {
        font-family: "Roboto", Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f8f8f8;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Navbar mobile */
      .navbar {
        display: none;
        background-color: #333;
        color: #fff;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
      }

      .menu-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 1.8em;
        cursor: pointer;
      }

      /* Container utama */
      .container {
        flex: 1;
        display: flex;
        height: calc(100vh - 50px);
        overflow: hidden;
      }

      /* Sidebar */
      .sidebar {
        flex: 0 0 280px;
        background-color: #ededed;
        padding: 20px;
        overflow-y: auto;
        border-right: 1px solid #ccc;
        transition: transform 0.3s ease;
        z-index: 2000;
      }

      .sidebar h2,
      .sidebar p {
        margin-top: 0;
        margin-bottom: 20px;
        font-weight: 600;
        color: #212121;
      }

      .chat-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .chat {
        padding: 15px 12px;
        border-bottom: 1px solid #ddd;
        cursor: pointer;
        border-radius: 8px;
        transition: background-color 0.2s ease;
      }

      .chat:hover {
        background-color: #f0f0f0;
      }

      /* Overlay saat sidebar aktif di mobile */
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 50px;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1500;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .sidebar-overlay.active {
        display: block;
        opacity: 1;
        pointer-events: all;
      }

      /* Chat container */
      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        background-color: #fff;
        overflow: hidden;
      }

      /* Header chat */
      .chat-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 20px;
        border-bottom: 1px solid #ccc;
        background: #f9f9f9;
      }

      .chat-header p {
        font-size: 1.25rem;
        font-weight: 700;
        color: #212121;
        margin: 0;
        display: flex;
        align-items: center;
      }

      .chat-header img.icon {
        width: 18px;
        height: 18px;
        margin-left: 6px;
      }

      .chat-header img.trash {
        width: 22px;
        height: 22px;
        cursor: pointer;
        filter: grayscale(100%);
        transition: filter 0.2s ease;
      }

      .chat-header img.trash:hover {
        filter: none;
      }

      /* Chat box area */
      .chat-box {
        flex-grow: 1;
        overflow-y: auto;
        padding: 20px;
        background-color: #fff;
      }

      /* Message container */
      .message-container {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      /* Profil image */
      .profile-image {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 12px;
      }

      /* Message content */
      .message-content {
        max-width: 75%;
        display: flex;
        flex-direction: column;
      }

      .username {
        font-weight: 700;
        font-size: 14px;
        margin-bottom: 4px;
        color: #333;
      }

      .message {
        padding: 10px 14px;
        border-radius: 14px;
        font-family: "Inter", Arial, sans-serif;
        font-size: 15px;
        line-height: 1.5;
        color: #333;
        background-color: #e2e2e2;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      /* Pesan user berbeda warna & align */
      .message-container.user {
        flex-direction: row-reverse;
      }

      .message-container.user .profile-image {
        margin-left: 12px;
        margin-right: 0;
      }

      .message-container.user .message {
        background-color: #d1f0ff;
      }

      /* ===== IMPROVED CODE BLOCK STYLING ===== */
      .code-block {
        background: #f8f8f8;
        border-radius: 8px;
        margin: 4px 0;
        overflow: hidden;
        display: flex;
        flex-direction: column; /* Susun vertikal (atas ke bawah) */
        align-items: flex-start;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border: 1px solid #ddd;
      }

      .code-header {
        background: #f0f0f0;
        width: 100%;
        align-items: stretch;
        color: #555;
        padding: 8px 12px;
        font-family: "Roboto Mono", monospace;
        font-size: 0.85em;
        display: flex;
        justify-content: space-between;
        border-bottom: 1px solid #ddd;
      }

      .code-header .language {
        font-weight: 600;
      }

      .code-header .copy-btn {
        background: #e0e0e0;
        color: #555;
        border: none;
        border-radius: 4px;
        padding: 2px 8px;
        font-size: 0.75em;
        cursor: pointer;
        margin-right: 15px;
        transition: all 0.2s ease;
      }

      .code-header .copy-btn:hover {
        background: #d0d0d0;
        color: #333;
      }

      pre {
        margin: 0;
        padding: 12px;
        overflow-x: auto;
      }

      code {
        font-family: "Roboto Mono", monospace;
        font-size: 0.9em;
        line-height: 1.5;
        color: #333;
        white-space: pre;
        display: block;
      }

      /* Syntax highlighting colors - light theme */
      .keyword {
        color: #0066cc;
      } /* blue */
      .string {
        color: #c7254e;
      } /* red */
      .comment {
        color: #999;
      } /* gray */
      .number {
        color: #099;
      } /* teal */
      .function {
        color: #458;
      } /* dark blue */
      .operator {
        color: #555;
      } /* dark gray */
      .punctuation {
        color: #555;
      } /* dark gray */
      .tag {
        color: #0066cc;
      } /* blue */
      .attr {
        color: #458;
      } /* dark blue */
      .property {
        color: #458;
      } /* dark blue */
      .value {
        color: #c7254e;
      } /* red */
      .boolean {
        color: #0066cc;
      } /* blue */
      .null {
        color: #0066cc;
      } /* blue */
      .this {
        color: #458;
      } /* dark blue */
      .class-name {
        color: #0099cc;
      } /* light blue */

      /* Inline code styling */
      .inline-code {
        background: rgba(175, 184, 193, 0.2);
        border-radius: 4px;
        padding: 2px 6px;
        font-family: "Roboto Mono", monospace;
        font-size: 0.9em;
        color: #c7254e;
        border: 1px solid #ddd;
      }

      /* Text segment styling */
      .text-segment {
        margin: 8px 0;
        line-height: 1.7;
        color: #333;
      }

      /* Input area */
      .input-container {
        display: flex;
        align-items: center;
        padding: 10px 20px;
        border-top: 1px solid #ccc;
        background: #f9f9f9;
      }

      .input-container input[type="text"] {
        flex: 1;
        padding: 12px 16px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 30px;
        outline: none;
        background-color: #fff;
        transition: border-color 0.3s ease;
      }

      .input-container input[type="text"]:focus {
        border-color: #3a88d6;
      }

      .input-container button {
        margin-left: 12px;
        background-color: #3a88d6;
        border: none;
        border-radius: 50%;
        padding: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease;
      }

      .input-container button:hover {
        background-color: #2a78c6;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
      }

      .input-container button .material-icons {
        font-size: 24px;
        color: #fff;
      }

      /* Footer copyright */
      .footer {
        text-align: center;
        font-size: 14px;
        color: #666;
        padding: 8px 0;
        background: #f9f9f9;
        border-top: 1px solid #ddd;
      }

      /* Loading animation dots */
      .loading-animation .dot {
        animation: blink 1.5s infinite;
        display: inline-block;
        margin: 0 2px;
        font-weight: bold;
        font-size: 20px;
      }
      .loading-animation .dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .loading-animation .dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes blink {
        0% {
          opacity: 0.2;
        }
        20% {
          opacity: 1;
        }
        100% {
          opacity: 0.2;
        }
      }

      /* ========== RESPONSIVE MOBILE ========== */
      @media (max-width: 768px) {
        body {
          height: 100vh;
        }

        .navbar {
          display: flex;
        }

        .container {
          flex-direction: column;
          height: calc(100vh - 50px);
        }

        /* Sidebar menjadi off-canvas */
        .sidebar {
          position: fixed;
          top: 50px;
          left: 0;
          height: calc(100vh - 50px);
          width: 250px;
          background-color: #ededed;
          padding: 20px;
          box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);
          border-right: none;
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          z-index: 2000;
          overflow-y: auto;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        /* Overlay */
        .sidebar-overlay {
          position: fixed;
          top: 50px;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.4);
          z-index: 1500;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.3s ease;
        }
        .sidebar-overlay.active {
          opacity: 1;
          pointer-events: all;
        }

        /* Chat container full width */
        .chat-container {
          flex: 1;
          margin-top: 0;
          border: none;
          overflow: hidden;
        }

        /* Chat box padding dikurangi */
        .chat-box {
          padding: 15px 10px;
        }

        /* Message container dan font size disesuaikan */
        .message-container {
          margin-bottom: 12px;
        }

        .profile-image {
          width: 36px;
          height: 36px;
        }

        .message-content {
          max-width: 80%;
        }

        .message {
          font-size: 14px;
          padding: 8px 12px;
        }

        /* Input container padat */
        .input-container {
          padding: 8px 12px;
        }

        .input-container input[type="text"] {
          font-size: 14px;
          padding: 10px 14px;
        }

        .input-container button {
          padding: 10px;
          margin-left: 8px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navbar Mobile -->
    <div class="navbar">
      <button class="menu-btn" id="leftMenuBtn" aria-label="Toggle sidebar">&#9776;</button>
      <div>AI DIGGING</div>
      <div style="width: 32px"></div>
    </div>

    <div class="container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <h2>Choose the conversation</h2>
        <p>Please select a conversation to start chatting.</p>
        <ul class="chat-list">
          <li class="chat">Chat 1</li>
          <li class="chat">Chat 2</li>
          <li class="chat">Chat 3</li>
          <li class="chat">Chat 4</li>
        </ul>
      </aside>

      <!-- Overlay -->
      <div class="sidebar-overlay" id="sidebarOverlay"></div>

      <!-- Chat Container -->
      <section class="chat-container">
        <header class="chat-header">
          <p>
            AI DIGGING
            <img src="https://cdn-icons-png.flaticon.com/512/992/992700.png" alt="verified icon" class="icon" />
          </p>
          <img src="https://cdn-icons-png.flaticon.com/512/1214/1214428.png" alt="trash" class="trash" title="Delete chat" id="clearChatBtn" />
        </header>

        <div class="chat-box" id="chatBox">
          <!-- Messages will appear here -->
        </div>

        <form class="input-container" id="chatForm">
          <input id="chatInput" type="text" placeholder="Type your message here..." autocomplete="off" required />
          <button type="submit" aria-label="Send message">
            <span class="material-icons">send</span>
          </button>
        </form>
      </section>
    </div>

    <footer class="footer">© 2025 AI DIGGING. By M Putra Ramadhani-Id</footer>

    <script>
      // Sidebar Toggle
      const leftMenuBtn = document.getElementById("leftMenuBtn");
      const sidebar = document.getElementById("sidebar");
      const sidebarOverlay = document.getElementById("sidebarOverlay");

      leftMenuBtn.addEventListener("click", () => {
        sidebar.classList.toggle("active");
        sidebarOverlay.classList.toggle("active");
      });

      sidebarOverlay.addEventListener("click", () => {
        sidebar.classList.remove("active");
        sidebarOverlay.classList.remove("active");
      });

      // Chat Functionality
      const chatBox = document.getElementById("chatBox");
      const chatForm = document.getElementById("chatForm");
      const chatInput = document.getElementById("chatInput");
      const clearChatBtn = document.getElementById("clearChatBtn");

      let messages = [];
      let isLoading = false;
      let loadingMessageId = null;

      chatForm.addEventListener("submit", (e) => {
        e.preventDefault();
        sendMessage();
      });

      clearChatBtn.addEventListener("click", clearChat);

      function sendMessage() {
        const text = chatInput.value.trim();
        if (!text || isLoading) return;

        appendMessage("user", text, "You", "https://cdn-icons-png.flaticon.com/512/1077/1077114.png");
        chatInput.value = "";
        chatInput.disabled = true;
        isLoading = true;

        messages.push({ role: "user", content: text });
        saveMessagesToStorage();

        loadingMessageId = appendLoadingMessage();

        fetch("https://api.paxsenix.biz.id/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer YOUR_API_KEY_HERE",
          },
          body: JSON.stringify({
            messages: messages,
            model: "gpt-4",
            temperature: 0.7,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            const reply = data.choices?.[0]?.message?.content?.trim() || "AI didn't provide a response.";
            removeLoadingMessage();
            appendMessage("bot", reply, "AI Digging", "https://cdn-icons-png.flaticon.com/512/4128/4128606.png");
            messages.push({ role: "assistant", content: reply });
            saveMessagesToStorage();
          })
          .catch((err) => {
            console.error("API error:", err);
            removeLoadingMessage();
            appendMessage("bot", "Sorry, there was an error connecting to the API.", "AI Digging", "https://cdn-icons-png.flaticon.com/512/4128/4128606.png");
          })
          .finally(() => {
            isLoading = false;
            chatInput.disabled = false;
            chatInput.focus();
          });
      }

      function appendLoadingMessage() {
        const messageContainer = document.createElement("div");
        messageContainer.id = "loading-message";
        messageContainer.className = "message-container";

        const profileImg = document.createElement("img");
        profileImg.src = "https://cdn-icons-png.flaticon.com/512/4128/4128606.png";
        profileImg.className = "profile-image";

        const contentContainer = document.createElement("div");
        contentContainer.className = "message-content";

        const nameEl = document.createElement("div");
        nameEl.className = "username";
        nameEl.textContent = "AI Digging";

        const loadingDots = document.createElement("div");
        loadingDots.className = "message loading-animation";
        loadingDots.innerHTML = `<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>`;

        contentContainer.appendChild(nameEl);
        contentContainer.appendChild(loadingDots);
        messageContainer.appendChild(profileImg);
        messageContainer.appendChild(contentContainer);
        chatBox.appendChild(messageContainer);
        chatBox.scrollTop = chatBox.scrollHeight;

        return "loading-message";
      }

      function removeLoadingMessage() {
        const el = document.getElementById("loading-message");
        if (el) el.remove();
      }

      function appendMessage(sender, text, username, profileUrl) {
        const messageContainer = document.createElement("div");
        messageContainer.className = `message-container ${sender}`;

        const profileImg = document.createElement("img");
        profileImg.src = profileUrl;
        profileImg.className = "profile-image";

        const contentContainer = document.createElement("div");
        contentContainer.className = "message-content";

        const nameEl = document.createElement("div");
        nameEl.className = "username";
        nameEl.textContent = username;

        const textEl = document.createElement("div");
        textEl.className = "message";
        textEl.innerHTML = parseMarkdown(text);

        contentContainer.appendChild(nameEl);
        contentContainer.appendChild(textEl);
        messageContainer.appendChild(profileImg);
        messageContainer.appendChild(contentContainer);
        chatBox.appendChild(messageContainer);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function parseMarkdown(text) {
        // Handle code blocks first
        const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
        const segments = [];
        let lastIndex = 0;
        let match;

        while ((match = codeBlockRegex.exec(text)) !== null) {
          const [fullMatch, lang, code] = match;
          const index = match.index;

          if (index > lastIndex) {
            segments.push({
              type: "text",
              content: text.slice(lastIndex, index),
            });
          }

          segments.push({
            type: "code",
            content: code,
            language: lang || "plaintext",
          });

          lastIndex = index + fullMatch.length;
        }

        if (lastIndex < text.length) {
          segments.push({
            type: "text",
            content: text.slice(lastIndex),
          });
        }

        return segments
          .map((segment) => {
            if (segment.type === "text") {
              let html = segment.content
                .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
                .replace(/\*(.*?)\*/g, "<em>$1</em>")
                .replace(/`(.*?)`/g, '<code class="inline-code">$1</code>')
                .replace(/\n/g, "<br>");

              return `<div class="text-segment">${html}</div>`;
            } else {
              const highlightedCode = highlightSyntax(segment.content, segment.language);

              return `
              <div class="code-block">
                <div class="code-header">
                  <span class="language">${segment.language || "code"}</span>
                  <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="language-${segment.language || "plaintext"}"><code>${highlightedCode}</code></pre>
              </div>
            `;
            }
          })
          .join("");
      }

      function highlightSyntax(code, language = "plaintext") {
        // Basic syntax highlighting patterns
        const patterns = {
          javascript: [
            { regex: /(\/\/.*|\/\*[\s\S]*?\*\/)/g, class: "comment" },
            {
              regex:
                /(\b(?:function|const|let|var|if|else|for|while|return|class|import|export|new|this|true|false|null|undefined|typeof|instanceof|await|async|yield|break|case|catch|continue|default|delete|do|finally|in|of|switch|throw|try|with)\b)/g,
              class: "keyword",
            },
            { regex: /(=>|\|\||&&|[+\-*/%&|^~=!<>?])=?|\+\+|--|\.{3}/g, class: "operator" },
            { regex: /(".*?"|'.*?'|`[\s\S]*?`)/g, class: "string" },
            { regex: /(\b\d+(\.\d+)?\b)/g, class: "number" },
            { regex: /(\bfunction\b)\s+([a-zA-Z_$][0-9a-zA-Z_$]*)/g, replace: '<span class="keyword">$1</span> <span class="function">$2</span>' },
            { regex: /(\bclass\b)\s+([a-zA-Z_$][0-9a-zA-Z_$]*)/g, replace: '<span class="keyword">$1</span> <span class="class-name">$2</span>' },
          ],
          html: [
            { regex: /(&lt;\/?[a-zA-Z][a-zA-Z0-9-]*)/g, class: "tag" },
            { regex: /([a-zA-Z-]+)=/g, class: "attr" },
            { regex: /(".*?"|'.*?')/g, class: "string" },
          ],
          css: [
            { regex: /([a-zA-Z-]+)\s*:/g, class: "property" },
            { regex: /(#([a-fA-F0-9]{3}){1,2}\b)/g, class: "value hex" },
            { regex: /(\b\d+(\.\d+)?(px|em|rem|%|s|ms|deg|rad|turn)\b)/g, class: "value number" },
          ],
        };

        let highlighted = code;
        const langPatterns = patterns[language] || [];

        langPatterns.forEach((pattern) => {
          if (pattern.replace) {
            highlighted = highlighted.replace(pattern.regex, pattern.replace);
          } else {
            highlighted = highlighted.replace(pattern.regex, `<span class="${pattern.class}">$&</span>`);
          }
        });

        return highlighted;
      }

      function copyCode(button) {
        const codeBlock = button.closest(".code-block");
        const code = codeBlock.querySelector("code").textContent;

        navigator.clipboard.writeText(code).then(() => {
          button.textContent = "Copied!";
          setTimeout(() => {
            button.textContent = "Copy";
          }, 2000);
        });
      }

      function saveMessagesToStorage() {
        localStorage.setItem("chatHistory", JSON.stringify(messages));
      }

      function loadMessagesFromStorage() {
        const stored = localStorage.getItem("chatHistory");
        if (stored) {
          messages = JSON.parse(stored);
          messages.forEach((msg) => {
            if (msg.role === "user") {
              appendMessage("user", msg.content, "You", "https://cdn-icons-png.flaticon.com/512/1077/1077114.png");
            } else {
              appendMessage("bot", msg.content, "AI Digging", "https://cdn-icons-png.flaticon.com/512/4128/4128606.png");
            }
          });
        }
      }

      function clearChat() {
        if (confirm("Are you sure you want to clear all chat history?")) {
          localStorage.removeItem("chatHistory");
          messages = [];
          chatBox.innerHTML = "";
        }
      }

      // Load chat when page opens
      document.addEventListener("DOMContentLoaded", loadMessagesFromStorage);
    </script>
  </body>
</html>
